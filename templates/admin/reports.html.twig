{% extends 'base.html.twig' %}

{% block title %}Админ – Тайлан{% endblock %}

{% block body %}
  <h2 style="margin:0 0 16px;">Хэрэглэгч бүрийн тайлан</h2>

  <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:100%;">
    <thead style="background:#f9fafb;">
      <tr>
        <th style="text-align:left;">Имэйл</th>
        <th style="text-align:right;">Гүйлгээ (тоо)</th>
        <th style="text-align:right;">Орлого</th>
        <th style="text-align:right;">Зарлага</th>
        <th style="text-align:right;">Цэвэр дүн</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
        {% set income  = (row.incomeTotal  is defined and row.incomeTotal  is not null) ? row.incomeTotal  : 0 %}
        {% set expense = (row.expenseTotal is defined and row.expenseTotal is not null) ? row.expenseTotal : 0 %}
        {% set net = income + expense %} {# expense нь сөрөг утгатай хадгалагдсан #}

        <tr>
          <td>{{ row.email }}</td>
          <td style="text-align:right;">{{ row.txCount|default(0) }}</td>
          <td style="text-align:right;">{{ income|number_format(2, '.', ',') }}</td>
          <td style="text-align:right;">{{ expense|number_format(2, '.', ',') }}</td>
          <td style="text-align:right; font-weight:600;">
            {{ net|number_format(2, '.', ',') }}
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="5" style="text-align:center; padding:12px;">Өгөгдөл алга.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
