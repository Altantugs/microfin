{% extends 'base.html.twig' %}
{% block title %}Гүйлгээний жагсаалт (Журнал){% endblock %}
{% block body %}
<h1>Гүйлгээний жагсаалт (Журнал)</h1>
<style>.tbl{width:100%;border-collapse:collapse}.tbl th,.tbl td{border:1px solid #ddd;padding:8px}.tbl th{background:#f7f7f7;position:sticky;top:0}.filters input{width:100%;box-sizing:border-box;padding:6px}.toolbar{display:flex;gap:16px;align-items:center;margin:10px 0 14px}</style>
<div class="toolbar">
  <label><input id="vatOnly" type="checkbox"> Зөвхөн НӨАТ-тай</label>
  <input id="globalSearch" type="text" placeholder="Нийт хайлт...">
</div>
<table id="txTable" class="tbl">
  <thead>
    <tr>
      <th>Д/д</th><th>Огноо</th><th>Гүйлгээний утга</th><th>Харилцагч</th><th>Дүн (Орлого/Дебит, Кредит)</th><th>НӨАТ</th>
    </tr>
    <tr class="filters">
      <th><input data-col="0" type="text" placeholder="#"></th>
      <th><input data-col="1" type="text" placeholder="Ж/нь: 2025-09-01"></th>
      <th><input data-col="2" type="text" placeholder="Утга"></th>
      <th><input data-col="3" type="text" placeholder="Харилцагч"></th>
      <th><input data-col="4" type="text" placeholder="дун/дебит/кредит"></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr><td>1</td><td>2025-09-01</td><td>Борлуулалт</td><td>ABC LLC</td><td>Дебит: 0 • Кредит: 850,000</td><td style="text-align:center"><input type="checkbox"></td></tr>
    <tr><td>2</td><td>2025-09-02</td><td>Худалдан авалт</td><td>ТӨХК ХХК</td><td>Дебит: 1,200,000 • Кредит: 0</td><td style="text-align:center"><input type="checkbox" checked></td></tr>
  </tbody>
</table>
<script>
(function(){
  const table=document.getElementById('txTable');
  const rows=[...table.tBodies[0].rows];
  const inputs=[...table.querySelectorAll('.filters input[data-col]')];
  const vatOnly=document.getElementById('vatOnly');
  const globalSearch=document.getElementById('globalSearch');
  const norm=s=>String(s||'').toLowerCase().trim();
  function pass(tr){
    for(const inp of inputs){
      const q=norm(inp.value); if(!q) continue;
      const col=+inp.dataset.col, cell=tr.cells[col]?.innerText||'';
      if(!norm(cell).includes(q)) return false;
    }
    if(vatOnly.checked){
      const cb=tr.cells[5]?.querySelector('input[type="checkbox"]');
      if(!(cb&&cb.checked)) return false;
    }
    const gq=norm(globalSearch.value);
    if(gq && !norm(tr.innerText).includes(gq)) return false;
    return true;
  }
  function apply(){ rows.forEach(tr=>tr.style.display=pass(tr)?'':'none'); }
  inputs.forEach(i=>i.addEventListener('input',apply));
  vatOnly.addEventListener('change',apply);
  globalSearch.addEventListener('input',apply);
})();
</script>
{% endblock %}
