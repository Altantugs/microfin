{# templates/security/login.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}Нэвтрэх{% endblock %}

{% block body %}
<h1>Нэвтрэх</h1>

<style>
  .auth{max-width:360px;margin:16px 0}
  .auth label{display:block;margin:10px 0 6px}
  .auth input[type="text"], .auth input[type="email"], .auth input[type="password"]{
    width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px
  }
  .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
  .btn{padding:10px 14px;border:1px solid #111;border-radius:6px;background:#111;color:#fff}
  .alert{padding:10px 12px;border-radius:6px;margin:10px 0}
  .alert.error{background:#fee2e2;color:#991b1b}
  .alert.success{background:#dcfce7;color:#166534}
  .muted{color:#6b7280;font-size:12px}
</style>

<div class="auth">
  {# Security error #}
  {% if error %}
    <div class="alert error">
      {{ error.messageKey|trans(error.messageData, 'security') }}
    </div>
  {% endif %}

  {# Flash messages #}
  {% for msg in app.flashes('success') %}
    <div class="alert success">{{ msg }}</div>
  {% endfor %}
  {% for msg in app.flashes('error') %}
    <div class="alert error">{{ msg }}</div>
  {% endfor %}

  {# If already logged in, show logout #}
  {% if app.user %}
    <p class="muted">
      Нэвтэрсэн: <strong>{{ app.user.userIdentifier ?? app.user.email }}</strong>
      — <a href="{{ path('app_logout') }}">Гарах</a>
    </p>
  {% endif %}

  <form method="post" action="{{ path('app_login') }}" autocomplete="on">
    <label for="username">Имэйл</label>
    <input id="username"
           type="text"
           name="_username"
           value="{{ last_username|default('') }}"
           autocomplete="email"
           required
           autofocus>

    <label for="password">Нууц үг</label>
    <input id="password"
           type="password"
           name="_password"
           autocomplete="current-password"
           required>

    {# CSRF token — security.yaml: form_login.enable_csrf:true үед идэвхтэй #}
    <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

    <div class="row">
      <label class="muted" style="display:flex;gap:6px;align-items:center">
        <input type="checkbox" name="_remember_me" value="on"> Намайг сана (14 хоног)
      </label>
      <button class="btn" type="submit">Нэвтрэх</button>
    </div>
  </form>
</div>
{% endblock %}
