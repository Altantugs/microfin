{% extends 'base.html.twig' %}
{% block title %}Гүйлгээний жагсаалт (Журнал){% endblock %}
{% block body %}
<h1>Гүйлгээний жагсаалт (Журнал)</h1>

<style>
  .tbl { width:100%; border-collapse:collapse; }
  .tbl th, .tbl td { border:1px solid #ddd; padding:8px; }
  .tbl th { background:#f7f7f7; position:sticky; top:0; }
  .filters input[type="text"]{ width:100%; box-sizing:border-box; padding:6px; }
  .toolbar{ display:flex; gap:16px; align-items:center; margin:10px 0 14px; }
</style>

<div class="toolbar">
  <label><input id="vatOnly" type="checkbox"> Зөвхөн НӨАТ-тай</label>
  <input id="globalSearch" type="text" placeholder="Нийт хайлт... (утга, харилцагч гэх мэт)">
</div>

<table id="txTable" class="tbl">
  <thead>
    <tr>
      <th>Д/д</th>
      <th>Огноо</th>
      <th>Гүйлгээний утга</th>
      <th>Харилцагч</th>
      <th>Дүн (Орлого/Дебит, Кредит)</th>
      <th>НӨАТ</th>
    </tr>
    <tr class="filters">
      <th><input data-col="0" type="text" placeholder="#"></th>
      <th><input data-col="1" type="text" placeholder="Ж/нь: 2025-09-01"></th>
      <th><input data-col="2" type="text" placeholder="Утга"></th>
      <th><input data-col="3" type="text" placeholder="Харилцагч"></th>
      <th><input data-col="4" type="text" placeholder="дун/дебит/кредит"></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {# TODO: Энд backend-аас ирэх мөрүүдийг рэндэрлэнэ. Доорх нь жишээ мөрүүд. #}
    <tr>
      <td>1</td>
      <td>2025-09-01</td>
      <td>Татвар шилжүүлэг</td>
      <td>ТӨХК ХХК</td>
      <td>Дебит: 1,200,000 • Кредит: 0</td>
      <td><input type="checkbox" checked disabled></td>
    </tr>
    <tr>
      <td>2</td>
      <td>2025-09-02</td>
      <td>Борлуулалтын орлого</td>
      <td>ABC LLC</td>
      <td>Дебит: 0 • Кредит: 850,000</td>
      <td><input type="checkbox" disabled></td>
    </tr>
  </tbody>
</table>

<script>
(function(){
  const table = document.getElementById('txTable');
  const rows = Array.from(table.tBodies[0].rows);
  const inputs = Array.from(table.querySelectorAll('.filters input[data-col]'));
  const vatOnly = document.getElementById('vatOnly');
  const globalSearch = document.getElementById('globalSearch');

  function normalize(s){ return (s||'').toString().toLowerCase().trim(); }

  function passesFilters(tr){
    // column filters
    for(const inp of inputs){
      const col = +inp.dataset.col;
      const q = normalize(inp.value);
      if(!q) continue;
      const cell = tr.cells[col]?.innerText || '';
      if(!normalize(cell).includes(q)) return false;
    }
    // VAT filter
    if(vatOnly.checked){
      const vatCell = tr.cells[5];
      const cb = vatCell?.querySelector('input[type="checkbox"]');
      if(!(cb && cb.checked)) return false;
    }
    // global search
    const gq = normalize(globalSearch.value);
    if(gq){
      const text = normalize(tr.innerText);
      if(!text.includes(gq)) return false;
    }
    return true;
  }

  function apply(){
    rows.forEach(tr => { tr.style.display = passesFilters(tr) ? '' : 'none'; });
  }

  inputs.forEach(i => i.addEventListener('input', apply));
  vatOnly.addEventListener('change', apply);
  globalSearch.addEventListener('input', apply);
})();
</script>
{% endblock %}
